<app-header></app-header>

<div
  class="dashboard-layout-root d-flex position-relative min-vh-100"
  [dir]="langService.isAr() ? 'rtl' : 'ltr'"
>
  <!-- Main Content -->
  <div
    class="content-area flex-grow-1 transition-all"
    [class.sidebar-offset]="isSidebarOpen()"
    [class.sidebar-collapsed]="!isSidebarOpen()"
  >
    <!-- Top Utility Bar (Search & User) -->
    <div
      class="utility-bar px-4 py-2 d-flex justify-content-between align-items-center bg-white border-bottom mb-3"
    >
      <div class="d-flex align-items-center gap-3">
        <button
          class="btn btn-dark-felosy rounded-circle shadow-sm d-lg-none p-2 d-flex align-items-center justify-content-center"
          style="width: 40px; height: 40px"
          (click)="toggleSidebar()"
        >
          <i class="bi bi-list fs-5"></i>
        </button>
        <div class="d-flex flex-column justify-content-center">
          <h1 class="fw-bold m-0 fs-6">
            {{ langService.isAr() ? 'لوحة التحكم المالية' : 'Financial Dashboard' }}
          </h1>
        </div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <button
          class="btn btn-light-soft border p-2 px-3 rounded-3 shadow-sm text-danger"
          (click)="onLogout()"
          [title]="langService.isAr() ? 'تسجيل الخروج' : 'Logout'"
        >
          <i class="bi bi-box-arrow-right fs-5"></i>
        </button>
        <button class="btn btn-dark-felosy p-2 px-3 shadow-lg" (click)="showSetupDialog.set(true)">
          <i class="bi bi-gear fs-5"></i>
        </button>
      </div>
    </div>

    <div class="container-fluid py-3 px-3 px-md-4 px-lg-5">
      <div
        class="d-flex flex-column flex-md-row justify-content-between align-items-md-center mb-4 mb-md-5 gap-3"
      >
        <div class="d-flex align-items-center gap-3">
          <div
            class="bg-dark rounded-3 p-2 d-flex align-items-center justify-content-center shadow-lg icon-md"
          >
            <i class="bi bi-grid-fill text-white fs-4"></i>
          </div>
          <div>
            <h1 class="fw-bold m-0 h5">
              {{ langService.isAr() ? 'نظرة عامة' : 'Overview' }}
            </h1>
            <p class="text-secondary small m-0">{{ getContent().subtitle }}</p>
          </div>
        </div>
      </div>

      @if (boardService.isLoading()) {
        <div class="d-flex justify-content-center py-5">
          <div class="spinner-border text-dark" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      } @else if (boardService.currentBoard()) {
        <!-- Summary Section -->
        <app-summary-cards></app-summary-cards>

        <!-- Wallets Section -->
        <!-- <app-wallet-grid [wallets]="wallets()"></app-wallet-grid> -->

        <!-- Wish List Section -->
        <app-wish-list></app-wish-list>

        <!-- Lower Sections (Alerts & Obligations) -->
        <div class="row g-5 mt-2">
          <div class="col-lg-12">
            <!-- Upcoming Payments/Obligations -->
            <div class="section-label d-flex justify-content-between align-items-center mb-4">
              <h6 class="fw-bold m-0">
                {{ langService.isAr() ? 'الالتزامات القادمة' : 'Upcoming Obligations' }}
              </h6>
              <button
                class="btn btn-dark-felosy rounded-pill p-1 px-4 fs-xs fw-bold d-flex align-items-center gap-2"
                (click)="showAddDialog.set(true)"
              >
                <i class="bi bi-plus"></i>
                <span>{{ langService.isAr() ? 'إضافة التزام' : 'Add Obligation' }}</span>
              </button>
            </div>
            <app-obligation-list></app-obligation-list>
          </div>
        </div>
      } @else {
        <!-- Empty State / Create Board -->
        <div
          class="text-center py-5 bg-white shadow-soft rounded-4 border border-dashed mx-auto empty-state-container"
        >
          <div class="mb-4">
            <i class="bi bi-calendar-event fs-1 text-secondary opacity-25"></i>
          </div>

          <h4 class="fw-bold mb-3">
            {{ langService.isAr() ? 'لا يوجد لوحة تحكم لهذا الشهر' : 'No board for this month' }}
          </h4>
          <p class="text-secondary mb-4 px-4 small">
            {{
              langService.isAr()
                ? 'يمكنك إنشاء لوحة تحكم جديدة للبدء في تتبع التزاماتك المالية.'
                : 'You can create a new dashboard to start tracking your financial obligations.'
            }}
          </p>
          <button
            class="btn btn-dark-felosy btn-lg rounded-pill px-5 fw-bold d-inline-flex align-items-center gap-2 shadow-lg"
            (click)="createBoard()"
          >
            <i class="bi bi-plus-lg"></i>
            <span>{{ langService.isAr() ? 'إنشاء لوحة تحكم' : 'Create Board' }}</span>
          </button>
        </div>
      }
    </div>
  </div>

  <!-- Mobile Backdrop -->
  @if (isSidebarOpen()) {
    <div class="sidebar-backdrop d-lg-none" (click)="toggleSidebar()"></div>
  }

  <!-- Sidebar Wrapper -->
  <aside
    class="sidebar-wrapper transition-all bg-white border-start"
    [class.collapsed]="!isSidebarOpen()"
    [class.mobile-open]="isSidebarOpen()"
  >
    <div class="sidebar-sticky py-4 px-1 px-md-3">
      <app-timeline-sidebar
        [isOpen]="isSidebarOpen()"
        (toggleSidebar)="isSidebarOpen.set(!isSidebarOpen())"
      ></app-timeline-sidebar>
    </div>
  </aside>
</div>

<app-add-obligation-dialog
  *ngIf="showAddDialog()"
  (close)="showAddDialog.set(false)"
></app-add-obligation-dialog>
<app-setup-basic-info
  *ngIf="showSetupDialog()"
  (close)="showSetupDialog.set(false)"
></app-setup-basic-info>
